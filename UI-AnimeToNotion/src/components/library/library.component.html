<div class="container" role="main">

  <!--!FILTERS-->
  <div class="filter-wrap">
    <div class="filter">

      <div class="filter__item searchbar">
        <div class="filter__name searchbar">
          Search
        </div>
        <div class="filter__field"><app-searchbar (valueChanged)="search($event)"></app-searchbar></div>
      </div>

      <div class="filter__item">
        <div class="filter__name">
          Year
        </div>
        <div class="filter__field"><app-select [initialValue]="initialValue" [values]="selectYear" [background]="filterBackground" (valueChanged)="setFilter('year',$event)"></app-select></div>
      </div>

      <div class="filter__item">
        <div class="filter__name">
          Status
        </div>
        <div class="filter__field"><app-select [initialValue]="initialValue" [values]="showStatuses" [background]="filterBackground" (valueChanged)="setFilter('status',$event)"></app-select></div>
      </div>

      <div class="filter__item">
        <div class="filter__name">
          Format
        </div>
        <div class="filter__field"><app-select [initialValue]="initialValue" [values]="selectFormat" [background]="filterBackground" (valueChanged)="setFilter('format',$event)"></app-select></div>
      </div>

    </div>

    <div class="extra-filter" (click)="switchShowSliders()" [class.extra-filter--active]="showSliders">
      <svg xmlns="http://www.w3.org/2000/svg" height="1rem" viewBox="0 0 512 512">
        <path fill="currentColor" d="M0 416c0 17.7 14.3 32 32 32l54.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48L480 448c17.7 0 32-14.3 32-32s-14.3-32-32-32l-246.7 0c-12.3-28.3-40.5-48-73.3-48s-61 19.7-73.3 48L32 384c-17.7 0-32 14.3-32 32zm128 0a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zM320 256a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zm32-80c-32.8 0-61 19.7-73.3 48L32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l246.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48l54.7 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-54.7 0c-12.3-28.3-40.5-48-73.3-48zM192 128a32 32 0 1 1 0-64 32 32 0 1 1 0 64zm73.3-64C253 35.7 224.8 16 192 16s-61 19.7-73.3 48L32 64C14.3 64 0 78.3 0 96s14.3 32 32 32l86.7 0c12.3 28.3 40.5 48 73.3 48s61-19.7 73.3-48L480 128c17.7 0 32-14.3 32-32s-14.3-32-32-32L265.3 64z" />
      </svg>
    </div>

  </div>

  <!--!SLIDERS-->
  <div *ngIf="showSliders" class="sliders" @YMovement_Opacity>
    <div>
      <app-slider [label]="'MAL Score'" (changeContext)="setFilter('malScore', $event)"></app-slider>
    </div>

    <div>
      <app-slider [label]="'Personal Score'" (changeContext)="setFilter('personalScore', $event)"></app-slider>
    </div>

    <div>
      <app-slider [label]="'Episodes'" (changeContext)="setFilter('episodes', $event)"></app-slider>
    </div>
  </div>

  <!--!SORT-->
  <app-sort (valueChanged)="setSort($event)" (valueChangedFavorites)="setFilter('favoritesOnly', $event)" (valueChangedPlanToWatch)="setFilter('plannedOnly', $event)"></app-sort>

  <!--!SHOWS-->
  <ng-container *ngIf="!searching">

    <div class="show-visualization" *ngIf="noResults === false; else noResultsCont">
      <div class="show-visualization__container">

        <div class="show-visualization__shows" infiniteScroll
            [infiniteScrollDistance]="0.3"
            [infiniteScrollThrottle]="350"
            (scrolled)="followingPage()">

          <ng-container *ngIf="libraryListStatic.length > 0 || (libraryList$ | async); else skeleton">
            <div *ngFor="let item of libraryListStatic; let i = index" class="show-visualization__item" (mouseenter)="libraryListTracker[i] = true" (mouseleave)="libraryListTracker[i] = false">

              <a class="show-visualization__cover">
                <img class="show-visualization__image" [class.show-visualization__image--loaded]="libraryListImages[i] == true" src="{{item.cover}}" (click)="editItem(item)" (load)="libraryListImages[i] = true">

                <!--BUTTONS-->
                <ng-container *ngTemplateOutlet="buttons; context: { item: item, list: libraryListTracker, index: i }"></ng-container>

              </a>
              <a class="show-visualization__show-title" (click)="editItem(item)">
                {{item.nameEnglish}}
              </a>

            </div>
            <ng-container *ngIf="loading; then skeleton"></ng-container>
          </ng-container>
          <ng-container *ngIf="loading; then skeleton"></ng-container>
        </div>
      </div>
    </div>

  </ng-container>

</div>


<!--SKELETON TEMPLATE-->
<ng-template #skeleton>
  <div *ngFor="let item of loadingSkeleton" class="show-visualization__item">
    <div class="show-visualization__cover show-visualization__cover--loading" @scaleUpOnEnter></div>
    <div class="show-visualization__show-title show-visualization__show-title--loading"></div>
  </div>
</ng-template>

<!--NO RESULTS TEMPLATE-->
<ng-template #noResultsCont>
  <div class="no-results" @opacityOnEnter>No Results</div>
</ng-template>

<!--BUTTONS TEMPLATE-->
<ng-template #buttons let-item="item" let-list="list" let-i="index">

  <div (mouseenter)="showImmersionButton = true" (mouseleave)="showImmersionButton = false">

    <div class="show-buttons" *ngIf="list[i]" @totalScale_OpacityOnEnter>

      <div class="show-buttons__item--main">

        <!--PLAN TO WATCH BUTTON-->
        <div class="show-buttons__item show-buttons__item--tooltip" label="Plan to Watch" *ngIf="item!.planToWatch === false" (click)="setPlanToWatch(item)">
          <svg class="show-buttons__icon--xl" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
            <path fill="currentColor" d="M184 24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H96c-35.3 0-64 28.7-64 64v16 48V448c0 35.3 28.7 64 64 64H416c35.3 0 64-28.7 64-64V192 144 128c0-35.3-28.7-64-64-64H376V24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H184V24zM80 192H432V448c0 8.8-7.2 16-16 16H96c-8.8 0-16-7.2-16-16V192zm176 40c-13.3 0-24 10.7-24 24v48H184c-13.3 0-24 10.7-24 24s10.7 24 24 24h48v48c0 13.3 10.7 24 24 24s24-10.7 24-24V352h48c13.3 0 24-10.7 24-24s-10.7-24-24-24H280V256c0-13.3-10.7-24-24-24z" />
          </svg>
        </div>

        <!--REMOVE FROM PLANNING-->
        <div class="show-buttons__item show-buttons__item--tooltip" label="Remove Planning" *ngIf="item!.planToWatch === true" (click)="setPlanToWatch(item)">
          <svg class="show-buttons__icon--xl" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
            <path fill="currentColor" d="M160 0c13.3 0 24 10.7 24 24V64H328V24c0-13.3 10.7-24 24-24s24 10.7 24 24V64h40c35.3 0 64 28.7 64 64v16 48V448c0 35.3-28.7 64-64 64H96c-35.3 0-64-28.7-64-64V192 144 128c0-35.3 28.7-64 64-64h40V24c0-13.3 10.7-24 24-24zM432 192H80V448c0 8.8 7.2 16 16 16H416c8.8 0 16-7.2 16-16V192zm-95 89l-47 47 47 47c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-47-47-47 47c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l47-47-47-47c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47 47-47c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z" />
          </svg>
        </div>

      </div>

    </div>

  </div>
</ng-template>
